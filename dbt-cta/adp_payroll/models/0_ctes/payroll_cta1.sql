-- SQL model to cast each column to its adequate SQL type converted from the JSON schema type
-- depends_on: {{ source('cta','_raw_payroll') }}

select
    -- casting existing fields to datatypes
    cast(Company_Code as {{ dbt_utils.type_string() }}) as Company_Code,
    cast(Payroll_Name as {{ dbt_utils.type_string() }}) as Payroll_Name,
    cast(File_Number as {{ dbt_utils.type_bigint() }}) as File_Number,
    cast(Associate_ID as {{ dbt_utils.type_string() }}) as Associate_ID,
    parse_date('%m/%d/%Y', Pay_Date) as Pay_Date,
    cast(Job_Title_Description as {{ dbt_utils.type_string() }}) as Job_Title_Description,
    cast(Home_Department_Code as {{ dbt_utils.type_string() }}) as Home_Department_Code,
    cast(Home_Department_Description as {{ dbt_utils.type_string() }}) as Home_Department_Description,
    cast(Worked_In_Department as {{ dbt_utils.type_string() }}) as Worked_In_Department,
    cast(Worked_In_Department_Description as {{ dbt_utils.type_string() }}) as Worked_In_Department_Description,
    cast(Distribution_Number as {{ dbt_utils.type_bigint() }}) as Distribution_Number,
    safe_cast(regexp_replace(replace(`Gross_Pay`, ',', ''), r'[$\s]', '') as float64) as `Gross_Pay_USD`,
    safe_cast(regexp_replace(replace(`Net_Pay`, ',', ''), r'[$\s]', '') as float64) as `Net_Pay_USD`,
    safe_cast(regexp_replace(replace(`Take_Home`, ',', ''), r'[$\s]', '') as float64) as `Take_Home_USD`,
    cast(Regular_Hours_Total as {{ dbt_utils.type_float() }}) as Regular_Hours_Total,
    cast(Overtime_Hours_Total as {{ dbt_utils.type_float() }}) as Overtime_Hours_Total,
    cast(Additional_Hours___HOL as {{ dbt_utils.type_float() }}) as Additional_Hours___HOL,
    cast(Additional_Hours___SIK as {{ dbt_utils.type_float() }}) as Additional_Hours___SIK,
    cast(Additional_Hours___PTO as {{ dbt_utils.type_float() }}) as Additional_Hours___PTO,
    cast(Additional_Hours___COV as {{ dbt_utils.type_float() }}) as Additional_Hours___COV,
    cast(Total_Hours as {{ dbt_utils.type_float() }}) as Total_Hours,
    safe_cast(regexp_replace(replace(`Regular_Earnings_Total`, ',', ''), r'[$\s]', '') as float64) as `Regular_Earnings_Total_USD`,
    safe_cast(regexp_replace(replace(`Overtime_Earnings_Total`, ',', ''), r'[$\s]', '') as float64) as `Overtime_Earnings_Total_USD`,
    safe_cast(regexp_replace(replace(`Additional_Earnings___HOL`, ',', ''), r'[$\s]', '') as float64) as `Additional_Earnings___HOL_USD`,
    safe_cast(regexp_replace(replace(`SIK___SICK_LEAVE_Earnings`, ',', ''), r'[$\s]', '') as float64) as `SIK___SICK_LEAVE_Earnings_USD`,
    safe_cast(regexp_replace(replace(`PTO_Earnings`, ',', ''), r'[$\s]', '') as float64) as `PTO_Earnings_USD`,
    safe_cast(regexp_replace(replace(`Additional_Earnings___COV`, ',', ''), r'[$\s]', '') as float64) as `Additional_Earnings___COV_USD`,
    safe_cast(regexp_replace(replace(`1FA___FF_FMLA_Earnings`, ',', ''), r'[$\s]', '') as float64) as `1FA___FF_FMLA_Earnings_USD`,
    safe_cast(regexp_replace(replace(`1FE___FF_PSL_EE_Earnings`, ',', ''), r'[$\s]', '') as float64) as `1FE___FF_PSL_EE_Earnings_USD`,
    safe_cast(regexp_replace(replace(`1FF___FF_PSL_FAM_Earnings`, ',', ''), r'[$\s]', '') as float64) as `1FF___FF_PSL_FAM_Earnings_USD`,
    safe_cast(regexp_replace(replace(`BN___BONUS_Earnings`, ',', ''), r'[$\s]', '') as float64) as `BN___BONUS_Earnings_USD`,
    safe_cast(regexp_replace(replace(`DEV___Phone_Bonus_Earnings`, ',', ''), r'[$\s]', '') as float64) as `DEV___Phone_Bonus_Earnings_USD`,
    safe_cast(regexp_replace(replace(`DIB___DRIVER_Earnings`, ',', ''), r'[$\s]', '') as float64) as `DIB___DRIVER_Earnings_USD`,
    safe_cast(regexp_replace(replace(`PER___PERSONAL_Earnings`, ',', ''), r'[$\s]', '') as float64) as `PER___PERSONAL_Earnings_USD`,
    safe_cast(regexp_replace(replace(`PPE___PRPD_Earnings_Earnings`, ',', ''), r'[$\s]', '') as float64) as `PPE___PRPD_Earnings_Earnings_USD`,
    safe_cast(regexp_replace(replace(`RF1___REFERRAL_Earnings`, ',', ''), r'[$\s]', '') as float64) as `RF1___REFERRAL_Earnings_USD`,
    safe_cast(regexp_replace(replace(`UPT___UNPAID_TIME_Earnings`, ',', ''), r'[$\s]', '') as float64) as `UPT___UNPAID_TIME_Earnings_USD`,
    safe_cast(regexp_replace(replace(`VAC___VACATION_Earnings`, ',', ''), r'[$\s]', '') as float64) as `VAC___VACATION_Earnings_USD`,
    safe_cast(regexp_replace(replace(`Total_Deductions`, ',', ''), r'[$\s]', '') as float64) as `Total_Deductions_USD`,
    safe_cast(regexp_replace(replace(`Family_Leave_Insurance___Employee_Tax`, ',', ''), r'[$\s]', '') as float64) as `Family_Leave_Insurance___Employee_Tax_USD`,
    safe_cast(regexp_replace(replace(`Federal_Income___Employee_Tax`, ',', ''), r'[$\s]', '') as float64) as `Federal_Income___Employee_Tax_USD`,
    safe_cast(regexp_replace(replace(`Lived_In_Local___Employee_Tax`, ',', ''), r'[$\s]', '') as float64) as `Lived_In_Local___Employee_Tax_USD`,
    safe_cast(regexp_replace(replace(`Lived_In_State___Employee_Tax`, ',', ''), r'[$\s]', '') as float64) as `Lived_In_State___Employee_Tax_USD`,
    safe_cast(regexp_replace(replace(`Local_4___Employee_Tax`, ',', ''), r'[$\s]', '') as float64) as `Local_4___Employee_Tax_USD`,
    safe_cast(regexp_replace(replace(`Local_5___Employee_Tax`, ',', ''), r'[$\s]', '') as float64) as `Local_5___Employee_Tax_USD`,
    safe_cast(regexp_replace(replace(`Medical_Leave_Insurance___Employee_Tax`, ',', ''), r'[$\s]', '') as float64) as `Medical_Leave_Insurance___Employee_Tax_USD`,
    safe_cast(regexp_replace(replace(`Medicare___Employee_Tax`, ',', ''), r'[$\s]', '') as float64) as `Medicare___Employee_Tax_USD`,
    safe_cast(regexp_replace(replace(`Medicare_Adjust___Employee_Tax`, ',', ''), r'[$\s]', '') as float64) as `Medicare_Adjust___Employee_Tax_USD`,
    safe_cast(regexp_replace(replace(`Medicare_Surtax_Adjust___Employee_Tax`, ',', ''), r'[$\s]', '') as float64) as `Medicare_Surtax_Adjust___Employee_Tax_USD`,
    safe_cast(regexp_replace(replace(`School_District___Employee_Tax`, ',', ''), r'[$\s]', '') as float64) as `School_District___Employee_Tax_USD`,
    safe_cast(regexp_replace(replace(`SDI___Employee_Tax`, ',', ''), r'[$\s]', '') as float64) as `SDI___Employee_Tax_USD`,
    safe_cast(regexp_replace(replace(`Social_Security___Employee_Tax`, ',', ''), r'[$\s]', '') as float64) as `Social_Security___Employee_Tax_USD`,
    safe_cast(regexp_replace(replace(`SUI___Employee_Tax`, ',', ''), r'[$\s]', '') as float64) as `SUI___Employee_Tax_USD`,
    safe_cast(regexp_replace(replace(`SUI_SDI___Employee_Tax`, ',', ''), r'[$\s]', '') as float64) as `SUI_SDI___Employee_Tax_USD`,
    safe_cast(regexp_replace(replace(`Transit___Employee_Tax`, ',', ''), r'[$\s]', '') as float64) as `Transit___Employee_Tax_USD`,
    safe_cast(regexp_replace(replace(`Worked_In_Local___Employee_Tax`, ',', ''), r'[$\s]', '') as float64) as `Worked_In_Local___Employee_Tax_USD`,
    safe_cast(regexp_replace(replace(`Worked_In_State___Employee_Tax`, ',', ''), r'[$\s]', '') as float64) as `Worked_In_State___Employee_Tax_USD`,
    safe_cast(regexp_replace(replace(`Workers_Comp_Assessment___Employee_Tax`, ',', ''), r'[$\s]', '') as float64) as `Workers_Comp_Assessment___Employee_Tax_USD`,
    safe_cast(regexp_replace(replace(`Family_Leave_Insurance___Employer_Tax`, ',', ''), r'[$\s]', '') as float64) as `Family_Leave_Insurance___Employer_Tax_USD`,
    safe_cast(regexp_replace(replace(`FUTA___Employer_Tax`, ',', ''), r'[$\s]', '') as float64) as `FUTA___Employer_Tax_USD`,
    safe_cast(regexp_replace(replace(`Lived_in_Local___Employer_Tax`, ',', ''), r'[$\s]', '') as float64) as `Lived_in_Local___Employer_Tax_USD`,
    safe_cast(regexp_replace(replace(`Lived_in_State___Employer_Tax`, ',', ''), r'[$\s]', '') as float64) as `Lived_in_State___Employer_Tax_USD`,
    safe_cast(regexp_replace(replace(`Local_4___Employer_Tax`, ',', ''), r'[$\s]', '') as float64) as `Local_4___Employer_Tax_USD`,
    safe_cast(regexp_replace(replace(`Local_5___Employer_Tax`, ',', ''), r'[$\s]', '') as float64) as `Local_5___Employer_Tax_USD`,
    safe_cast(regexp_replace(replace(`Medical_Leave_Insurance___Employer_Tax`, ',', ''), r'[$\s]', '') as float64) as `Medical_Leave_Insurance___Employer_Tax_USD`,
    safe_cast(regexp_replace(replace(`Medicare___Employer_Tax`, ',', ''), r'[$\s]', '') as float64) as `Medicare___Employer_Tax_USD`,
    safe_cast(regexp_replace(replace(`MTA___Employer_Tax`, ',', ''), r'[$\s]', '') as float64) as `MTA___Employer_Tax_USD`,
    safe_cast(regexp_replace(replace(`School_District___Employer_Tax`, ',', ''), r'[$\s]', '') as float64) as `School_District___Employer_Tax_USD`,
    safe_cast(regexp_replace(replace(`SDI___Employer_Tax`, ',', ''), r'[$\s]', '') as float64) as `SDI___Employer_Tax_USD`,
    safe_cast(regexp_replace(replace(`Social_Security___Employer_Tax`, ',', ''), r'[$\s]', '') as float64) as `Social_Security___Employer_Tax_USD`,
    safe_cast(regexp_replace(replace(`SUI___Employer_Tax`, ',', ''), r'[$\s]', '') as float64) as `SUI___Employer_Tax_USD`,
    safe_cast(regexp_replace(replace(`SUI_SDI___Employer_Tax`, ',', ''), r'[$\s]', '') as float64) as `SUI_SDI___Employer_Tax_USD`,
    safe_cast(regexp_replace(replace(`Transit___Employer_Tax`, ',', ''), r'[$\s]', '') as float64) as `Transit___Employer_Tax_USD`,
    safe_cast(regexp_replace(replace(`Worked_in_Local___Employer_Tax`, ',', ''), r'[$\s]', '') as float64) as `Worked_in_Local___Employer_Tax_USD`,
    safe_cast(regexp_replace(replace(`Worked_in_State___Employer_Tax`, ',', ''), r'[$\s]', '') as float64) as `Worked_in_State___Employer_Tax_USD`,
    safe_cast(regexp_replace(replace(`Workers_Comp_Assessment___Employer_Tax`, ',', ''), r'[$\s]', '') as float64) as `Workers_Comp_Assessment___Employer_Tax_USD`,
    cast(Void_Check_Indicator as {{ dbt_utils.type_string() }}) as Void_Check_Indicator,
    cast(Check_Voucher_Code as {{ dbt_utils.type_string() }}) as Check_Voucher_Code,
    cast(Check_Voucher_Number as {{ dbt_utils.type_bigint() }}) as Check_Voucher_Number,

    -- new fields
    {{ dbt_utils.surrogate_key([
        'Company_Code',
        'Payroll_Name',
        'File_Number',
        'Associate_ID',
        'Pay_Date',
        'Job_Title_Description',
        'Home_Department_Code',
        'Home_Department_Description',
        'Worked_In_Department',
        'Worked_In_Department_Description',
        'Distribution_Number',
        'Void_Check_Indicator',
        'Check_Voucher_Code',
        'Check_Voucher_Number',
    ]) }} as _payroll_hashid,
    {{ current_timestamp() }} as _cta_loaded_at

from {{ source('cta','_raw_payroll') }}
-- activities
where 1 = 1
