version: 2

sources: 
  - name: meta
    database: "{{ env_var('CTA_PROJECT_ID') }}"
    schema: monitoring
    tables:
      - name: dag_mapping
        description: >-
          This table is an external table backed by a Google Sheet, that maps dag IDs
          from some of our non-Daggy McDagface DAGs to their corresponding syncs and
          partners. We created this external table using the
          dbt-labs/dbt_external_tables package. If we need to update the structure of
          the data (not the data itself), it can be updated by running the following
          cmd:
            dbt run-operation stage_external_sources -t cta   
        external:
          location: https://docs.google.com/spreadsheets/d/{{ env_var('DAG_MAPPING_SHEET_ID') }}/edit
          options:
            format: GOOGLE_SHEETS
            skip_leading_rows: 1
        columns:
          - name: dag_id
            data_type: STRING
          - name: sync
            data_type: STRING
          - name: partner_name
            data_type: STRING
          - name: data_type
            data_type: STRING
      - name: excluded_dags
        description: >-
          This table is an external table backed by a Google Sheet that contains a list
          of dag_ids to exlcude from monitoring.

          If we need to update the structure of the data (not the data itself), it can
          be updated by running the following
          cmd:
            dbt run-operation stage_external_sources -t cta   
        external:
          location: https://docs.google.com/spreadsheets/d/{{ env_var('DAG_EXCLUSIONS_SHEET_ID') }}/edit
          options:
            format: GOOGLE_SHEETS
            skip_leading_rows: 1
        columns:
          - name: dag_id
            data_type: STRING

      - name: configured_syncs
        description: >
          This is an external table that is built off some json config living in
          Composer's dags/ folder in each environment, specifically:
            dags/cta-dags/airbyte_syncs/configs/configured_syncs.json
          
          If we ever need to update the structure of the data (not the data itself),
          then we'll need to manually drop and recreate the external table from the UI,
          since dbt-labs/dbt_external_tables doesn't support nested fields.
        columns:
          - name: dag_id
            tests:
              - not_null
              - unique
          - name: partners